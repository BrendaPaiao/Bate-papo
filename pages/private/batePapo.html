<!DOCTYPE html>
        <html lang="pt-br">
        <head>
            <meta charset="UTF-8">
            <meta name="viewport" content="width=device-width, initial-scale=1.0">
            <title>Bate-Papo</title>
            <link rel="stylesheet" href="styles/bate-papo.css">
            <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet"
    integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous">
        </head>
        <body>
            <h1>Bate-Papo</h1>
            <div id="chat-container">
                <div id="mensagens"></div>
            </div>

            <div id="message-input-container">
                <div class="form-group">
                    <p>Enviar Mensagem:</p>
                    <label for="usuario-select">Usuário:</label>
                    <select id="usuario-select" class="form-control">
                        <option value="">...</option>
                    </select>
                </div>
                <input type="text" id="message-input" placeholder="Digite sua mensagem" class="form-control mt-2">
                <button id="send-button" class="btn btn-primary mt-2">Enviar</button>
            </div>
            <p><a href="/menu">Voltar ao menu</a></p>

            <script>
                const sendButton = document.getElementById('send-button');
                const messageInput = document.getElementById('message-input');
                const messagesDiv = document.getElementById('mensagens');
                const usuarioSelect = document.getElementById('usuario-select');
                
                function carregarUsuarios() {
                    fetch('/usuarios')
                        .then(response => response.json())
                        .then(data => {
                            if (data && Array.isArray(data)) {
                                data.forEach(nickname => {
                                    const option = document.createElement('option');
                                    option.value = nickname;
                                    option.textContent = nickname;
                                    usuarioSelect.appendChild(option);
                                });
                            } else {
                                console.log('Erro: dados de usuários não encontrados');
                            }
                        })
                        .catch(error => console.log('Erro ao carregar usuários:', error));
                }

                let usuarioLogado = '';
                fetch('/usuarios')
                    .then(response => response.json())
                    .then(data => {
                        const usuario = data.find(u => u.nickname === 'seuNicknameLogado');
                        if (usuario) {
                            usuarioLogado = usuario.nickname;
                        }
                    });

                function displayMessages() {
                    fetch('/mensagens')
                        .then(response => response.json())
                        .then(data => {
                            messagesDiv.innerHTML = '';
                            data.forEach(msg => {
                                const msgElement = document.createElement('div');
                                msgElement.classList.add('message');
                                msgElement.classList.add(msg.usuario === 'seuNickname' ? 'user' : 'other');
                                msgElement.textContent = `${msg.usuario} (${msg.data}): ${msg.mensagem}`;
                                messagesDiv.appendChild(msgElement);
                            });
                        });
                }

                sendButton.addEventListener('click', () => {
                    const message = messageInput.value;
                    const destinatario = usuarioSelect.value;

                    if (message.trim() && destinatario) {
                        fetch('/enviarMensagem', {
                            method: 'POST',
                            headers: {
                                'Content-Type': 'application/x-www-form-urlencoded',
                            },
                            body: new URLSearchParams({ mensagem: message, destinatario: destinatario }),
                        })
                        .then(response => response.json())
                        .then(() => {
                            messageInput.value = '';
                            location.reload();
                        });
                    }
                });

                carregarUsuarios();
                displayMessages();
            </script>
        </body>
        </html>